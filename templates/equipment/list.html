
{% extends "base.html" %}
{% load static %}
{% block title %}トップページ{% endblock title %}
{% block content %}
<!-- 備品一覧ページ -->
<a class="item-active">備品一覧</a></li> <!-- ヘッダーから分離 -->
<main class="item-list">
<!-- フォーム要素でラップ -->
<form id="searchForm" onsubmit="searchTable(); return false;">
    <!-- 検索ボックス、ドロップダウンメニュー、検索ボタン -->
    <div class="search-container">
        <select id="searchCategory" class="search-category">
            <option value="all">すべて</option>
            <option value="equip_name">備品名</option>
            <option value="image">画像</option>
            <option value="category">カテゴリ</option>
            <option value="condition">状態</option>
            <option value="place">設置場所</option>
            <option value="description">説明</option>
            <option value="stock">在庫数</option>
            <option value="created_at">作成日</option>
            <option value="updated_at">更新日</option>
        </select>
        <input type="text" id="searchInput" class="list-search-box" placeholder="キーワードで検索する...">
        <button id="searchButton" class="search-button">検索</button>
    </div>
</form>
<div class="add-item-container">
    <a href="{% url 'equipment:add' %}" class="add-item-button">備品を追加</a>
</div>
<table id="itemTable" class="equipment-table">
    <thead>
        <tr align="center">
            <th>備品名</th>
            <th>画像</th>
            <th>カテゴリ</th>
            <th>状態</th>
            <th>設置場所</th>
            <th>説明</th>
            <th>在庫数</th>
            <th>作成日</th>
            <th>更新日</th>
        </tr>
    </thead>
    <tbody>
        {% for equipment in equipments %}
        <tr align="center">
            <td><a href="{% url 'equipment:detail' equipment.pk %}">{{ equipment.equip_name }}</a></td>
            <td>
                <a href="{% url 'equipment:detail' equipment.pk %}">
                    <img src="{{ equipment.image.url }}" alt="{{ equipment.equip_name }}" style="width: 100px; height: auto;">
                </a>
            </td>
            <td>{{ equipment.category }}</td>
            <td>{{ equipment.condition }}</td>
            <td>{{ equipment.place }}</td>
            <td class="description">{{ equipment.text }}</td>
            <td>{{ equipment.stock }}</td>
            <td>{{ equipment.created_at|date:"Y/m/d H:i" }}</td>
            <td>{{ equipment.updated_at|date:"Y/m/d H:i" }}</td>
        </tr>
        {% empty %}
        <tr align="center">
            <td colspan="9">備品が見つかりませんでした。</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</main>
<script>
    function searchTable() {
        let input = document.getElementById("searchInput").value.toLowerCase();
        let category = document.getElementById("searchCategory").value;
        let table = document.getElementById("itemTable");
        let rows = table.getElementsByTagName("tr");
        
        for (let i = 1; i < rows.length; i++) {
            let cells = rows[i].getElementsByTagName("td");
            let found = false;
            for (let j = 0; j < cells.length; j++) {
                if (category === 'all' || (category === 'equip_name' && j === 0) ||
                    (category === 'image' && j === 1) || (category === 'category' && j === 2) ||
                    (category === 'condition' && j === 3) || (category === 'place' && j === 4) ||
                    (category === 'description' && j === 5) || (category === 'stock' && j === 6) ||
                    (category === 'created_at' && j === 7) || (category === 'updated_at' && j === 8)) {
                    if (cells[j]) {
                        let txtValue = cells[j].textContent || cells[j].innerText;
                        if (txtValue.toLowerCase().indexOf(input) > -1) {
                            found = true;
                            break;
                        }
                    }
                }
            }
            rows[i].style.display = found ? "" : "none";
        }
    }
</script>
{% endblock content %}
