
{% extends "base.html" %}
{% load static %}
{% block title %}トップページ{% endblock title %}
{% block content %}
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
<!-- 備品一覧ページ -->
<a class="item-active">備品一覧</a></li> <!-- ヘッダーから分離 -->
<main class="item-list">
<!-- フォーム要素でラップ -->
<form id="searchForm" onsubmit="searchTable(); return false;">
    <!-- 検索ボックス、ドロップダウンメニュー、検索ボタン -->
    <div class="search-container">
        <select id="searchCategory" class="search-category">
            <option value="all">すべて</option>
            <option value="equip_name">備品名</option>
            <option value="image">画像</option>
            <option value="loan_status">貸出状況</option>
            <option value="category">カテゴリ</option>
            <option value="condition">状態</option>
            <option value="place">設置場所</option>
            <option value="description">説明</option>
            <option value="stock">在庫数</option>
            <option value="created_at">作成日</option>
            <option value="updated_at">更新日</option>
        </select>
        <input type="text" id="searchInput" class="list-search-box" placeholder="キーワードで検索する...">
        <button id="searchButton" class="search-button">検索</button>
    </div>
</form>
<div class="add-item-container">
    <a href="{% url 'equipment:add' %}" class="add-item-button">備品を追加</a>
</div>
<table id="itemTable" class="equipment-table">
    <thead>
        <tr align="center">
            <th>備品名</th>
            <th>画像</th>
            <th>貸出状況</th>
            <th>カテゴリ</th>
            <th>状態</th>
            <th>設置場所</th>
            <th>説明</th>
            <th>在庫数</th>
            <th>作成日</th>
            <th>更新日</th>
        </tr>
    </thead>
    <tbody>
        {% for equipment in equipments %}
        <tr align="center">
            <td><a href="{% url 'equipment:detail' equipment.pk %}">{{ equipment.equip_name }}</a></td>
            <td>
                <a href="{% url 'equipment:detail' equipment.pk %}">
                    {% if equipment.image %}
                        <img src="{{ equipment.image.url }}" alt="{{ equipment.equip_name }}" class="thumbnail-image" style="width: 100px; height: auto;">
                    {% else %}
                        <div class="no-image-list">
                            <span class="material-symbols-outlined">
                              <font color="#CCCCCC">
                                no_photography
                              </font>
                            </span>
                        </div>
                    {% endif %}
                </a>
            </td>
            <td>
            {% if equipment.loan_status == '貸出可' %}
            <span class="material-symbols-outlined">
                <font color="#69c44b"><b>circle</span>
            </span>
              貸出可
            {% elif equipment.loan_status == '貸出不可' %}
              <span class="material-symbols-outlined">
                <font color="#EB6161"><b>close
              </span>
              貸出不可
                </font></b>
            {% elif equipment.loan_status == '貸出中' %}
            <span class="material-symbols-outlined">
              <font color="#EB6161"><b>do_not_disturb_on
            </span>
            貸出中
              </font></b>
            {% else %}
            <span class="material-symbols-outlined">
              <font color="#00A0A8"><b>question_mark
            </span>
            その他（詳細は説明欄を参照）
            </font></b>
            {% endif %}
            </td>
            <td>{{ equipment.category }}</td>
            <td>{{ equipment.condition }}</td>
            <td>{{ equipment.place }}</td>
            <td class="description">{{ equipment.text }}</td>
            <td>{{ equipment.stock }}</td>
            <td>{{ equipment.created_at|date:"Y/m/d H:i" }}</td>
            <td>{{ equipment.updated_at|date:"Y/m/d H:i" }}</td>
        </tr>
        {% empty %}
        <tr align="center">
            <td colspan="9">備品が見つかりませんでした。</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</main>
<script>
    function searchTable() { 
        let input = document.getElementById("searchInput").value.toLowerCase();
        let category = document.getElementById("searchCategory").value;
        let table = document.getElementById("itemTable");
        let rows = table.getElementsByTagName("tr");
        
        for (let i = 1; i < rows.length; i++) {
            let cells = rows[i].getElementsByTagName("td");
            let found = false;
    
            for (let j = 0; j < cells.length; j++) {
                if ((category === 'all') || 
                    (category === 'equip_name' && j === 0) || 
                    (category === 'image' && j === 1) || 
                    (category === 'loan_status' && j === 2) ||  // 貸出状況
                    (category === 'category' && j === 3) || 
                    (category === 'condition' && j === 4) || 
                    (category === 'place' && j === 5) || 
                    (category === 'description' && j === 6) || 
                    (category === 'stock' && j === 7) || 
                    (category === 'created_at' && j === 8) || 
                    (category === 'updated_at' && j === 9)) {
                        
                    if (cells[j]) {
                        let txtValue = cells[j].textContent || cells[j].innerText;
                        if (txtValue.toLowerCase().indexOf(input) > -1) {
                            found = true;
                            break;
                        }
                    }
                }
            }
            rows[i].style.display = found ? "" : "none";
        }
    }
</script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const thumbnailElements = document.querySelectorAll("img.thumbnail-image");
        thumbnailElements.forEach(function(thumbnail) {
            thumbnail.onerror = function() {
                // 画像を非表示にし、代わりにエラーメッセージを表示
                thumbnail.style.display = "none";
                const noImageListDiv = document.createElement("div");
                noImageListDiv.className = "no-image-list";
                noImageListDiv.innerHTML = `
                    <span class="material-symbols-outlined">
                      <font color="#CCCCCC">
                        no_photography
                      </font>
                    </span>
                `;
                thumbnail.parentNode.appendChild(noImageListDiv);
            }
        });
    });
</script>
{% endblock content %}
